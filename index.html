<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Habit Tracker</title>
<style>
:root {
  --bg: #0f1220;
  --card: #1b1f3b;
  --accent: #7c7cff;
  --accent-2: #2dd4bf;
  --text: #e5e7eb;
  --muted: #9ca3af;
  --success: #22c55e;
  --warn: #facc15;
  --danger: #f87171;
  --orange: #f59e0b;
  --red: #ef4444;
}
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
  overflow: hidden;
}
body {
  background: linear-gradient(180deg, var(--bg), #14173a);
  color: var(--text);
  position: relative;
}
.app {
  max-width: 420px;
  margin: auto;
  height: 100%;
  display: flex;
  flex-direction: column;
}
header {
  padding: 20px;
  text-align: center;
  font-size: 1.5rem;
  font-weight: 600;
}
.dateNav {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 10px;
}
.dateNav button {
  background: var(--accent-2);
  border: none;
  border-radius: 8px;
  padding: 6px 12px;
  color: white;
  font-weight: 600;
}
main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
#habitContainer {
  flex: 1;
  overflow-y: auto;
  padding: 0 16px 16px 16px;
}
.card {
  background: linear-gradient(135deg, #1b1f3b, #232861);
  border-radius: 18px;
  padding: 16px;
  margin-bottom: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}
.habit {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  cursor: grab;
  touch-action: none;
}
.habit.dragging { opacity: 0.5; }
.habit span { flex: 1; cursor: pointer; }
.habit button {
  background: var(--accent);
  border: none;
  color: white;
  border-radius: 12px;
  padding: 8px 14px;
  font-weight: 600;
}
.progress {
  width: 100%;
  height: 10px;
  background: #111827;
  border-radius: 10px;
  overflow: hidden;
  margin: 8px 16px;
}
.progress div {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--accent-2));
  width: 0%;
  transition: width 0.4s;
}
.tabs {
  display: flex;
  border-top: 1px solid #1f2937;
  background: #0b0e1a;
}
.tab {
  flex: 1;
  padding: 14px;
  text-align: center;
  font-weight: 600;
  color: var(--muted);
}
.tab.active { color: var(--accent); }
.hidden { display: none; }
.add {
  margin: 10px 16px;
  display: flex;
  gap: 8px;
  background: var(--card);
  border-radius: 12px;
  padding: 8px;
}
.add input {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #1b1f3b;
  color: var(--text);
}
.add button {
  background: var(--accent-2);
  border: none;
  border-radius: 10px;
  padding: 10px 14px;
  font-weight: 600;
}
.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-top: 10px;
}
.day {
  aspect-ratio: 1;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: var(--text);
  background: #1b1f3b;
  border: 2px solid transparent;
  box-sizing: border-box;
}
.day.today { outline: 2px solid var(--accent); }
.day.red { border-color: var(--red); }
.day.orange { border-color: var(--orange); }
.day.green { border-color: var(--success); }
</style>
</head>
<body>
<div class="app">
  <header id="headerDate"></header>
  <div class="dateNav">
    <button onclick="prevDay()">◀</button>
    <span id="currentDate"></span>
    <button onclick="nextDay()">▶</button>
  </div>
  <main>
    <div id="homeView">
      <div id="habitContainer"></div>
      <div class="progress"><div id="dailyBar"></div></div>
      <p id="streakText" style="padding:0 16px;"></p>
      <div class="add">
        <input id="newHabit" placeholder="Add new habit" />
        <button onclick="addHabit()">Add</button>
      </div>
    </div>
    <div id="monthView" class="hidden">
      <div class="card">
        <h3>Monthly Overview</h3>
        <div class="calendar" id="monthCalendar"></div>
      </div>
    </div>
  </main>
  <div class="tabs">
    <div class="tab active" onclick="showTab('home')">Habits</div>
    <div class="tab" onclick="showTab('month')">Month</div>
  </div>
</div>
<script>
let habits = JSON.parse(localStorage.getItem('habits')||'[]');
let history = JSON.parse(localStorage.getItem('history')||'{}');
let currentDate = new Date();
let dragIndex = null;

function formatDate(d){ return d.toLocaleString('en-US',{month:'short',day:'numeric'}); }
function today(){currentDate=new Date(); render();}
function prevDay(){currentDate.setDate(currentDate.getDate()-1); render();}
function nextDay(){currentDate.setDate(currentDate.getDate()+1); render();}

function save(){ localStorage.setItem('habits',JSON.stringify(habits)); localStorage.setItem('history',JSON.stringify(history)); }

function render(){
  document.getElementById('headerDate').innerText = formatDate(currentDate);
  document.getElementById('currentDate').innerText = formatDate(currentDate);
  renderHabits(); renderMonth();
}

function renderHabits(){
  const container = document.getElementById('habitContainer');
  container.innerHTML='';
  const key = currentDate.toLocaleDateString('en-CA');
  if(!history[key]) history[key]={};

  habits.forEach((h,index)=>{
    const done = history[key][h]||false;
    const div=document.createElement('div');
    div.className='habit';

    const span=document.createElement('span');
    span.innerText=h;
    span.addEventListener('dblclick',()=>editHabit(h));

    const btn=document.createElement('button');
    btn.innerText=done?'✓':'Done';
    btn.addEventListener('click',()=>toggleHabit(h));

    div.appendChild(span);
    div.appendChild(btn);

    // Touch / pointer events for drag
    div.addEventListener('pointerdown', e => {
      dragIndex = index;
      div.setPointerCapture(e.pointerId);
    });
    div.addEventListener('pointerup', e => { dragIndex=null; div.releasePointerCapture(e.pointerId); });

    div.addEventListener('pointermove', e => {
      if(dragIndex!==null){
        const rects = Array.from(container.children).map(c=>c.getBoundingClientRect());
        for(let i=0;i<rects.length;i++){
          if(e.clientY>rects[i].top && e.clientY<rects[i].bottom){
            if(i!==dragIndex){
              const moved=habits.splice(dragIndex,1)[0];
              habits.splice(i,0,moved);
              dragIndex=i;
              save(); renderHabits();
            }
            break;
          }
        }
      }
    });

    container.appendChild(div);
  });
  updateProgress();
}

function editHabit(h){
  const newName=prompt('Edit habit name:',h);
  if(newName && newName!==h){
    habits=habits.map(x=>x===h?newName:x);
    for(const date in history){
      if(history[date][h]!==undefined){
        history[date][newName]=history[date][h]; delete history[date][h];
      }
    }
    save(); render();
  }
}

function toggleHabit(h){
  const key=currentDate.toLocaleDateString('en-CA');
  history[key][h]=!history[key][h];
  save(); renderHabits();
}

function addHabit(){
  const input=document.getElementById('newHabit');
  if(!input.value) return;
  habits.push(input.value); input.value=''; save(); renderHabits();
}

function updateProgress(){
  const key=currentDate.toLocaleDateString('en-CA');
  const done=Object.values(history[key]||{}).filter(Boolean).length;
  const pct=habits.length ? Math.round(done/habits.length*100) : 0;
  document.getElementById('dailyBar').style.width=pct+'%';
  document.getElementById('streakText').innerText=`Completed ${pct}%`;
}

function showTab(tab){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('#homeView,#monthView').forEach(v=>v.classList.add('hidden'));
  if(tab==='home'){document.getElementById('homeView').classList.remove('hidden'); document.querySelectorAll('.tab')[0].classList.add('active');}
  else{document.getElementById('monthView').classList.remove('hidden'); document.querySelectorAll('.tab')[1].classList.add('active'); renderMonth();}
}

function renderMonth(){
  const monthCal=document.getElementById('monthCalendar');
  monthCal.innerHTML='';
  const d=new Date(currentDate.getFullYear(),currentDate.getMonth(),1);
  const firstDay=d.getDay();
  const daysInMonth=new Date(d.getFullYear(),d.getMonth()+1,0).getDate();
  for(let i=0;i<firstDay;i++){ const empty=document.createElement('div'); empty.className='day empty'; monthCal.appendChild(empty); }
  for(let i=1;i<=daysInMonth;i++){
    const day=new Date(d.getFullYear(),d.getMonth(),i);
    const key=day.toLocaleDateString('en-CA');
    const div=document.createElement('div'); div.className='day'; div.innerText=i;
    if(history[key]){
      const vals=Object.values(history[key]);
      const pct=vals.length ? vals.filter(Boolean).length/vals.length : 0;
      if(pct>=0.75) div.classList.add('green');
      else if(pct>=0.5) div.classList.add('orange');
      else div.classList.add('red');
    }
    const todayKey=new Date().toLocaleDateString('en-CA');
    if(key===todayKey) div.classList.add('today');
    monthCal.appendChild(div);
  }
}

render();
</script>
</body>
</html>
