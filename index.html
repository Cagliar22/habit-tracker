<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Habit Tracker</title>

  <style>
    :root {
      --bg: #0b1220;
      --card: #111827;
      --text: #f3f4f6;
      --muted: #9ca3af;
      --accent: #38bdf8;
      --success: #34d399;
      --danger: #f87171;
      --shadow: rgba(0,0,0,0.35);
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #020617;
        --muted: #475569;
        --accent: #0284c7;
        --success: #16a34a;
        --danger: #dc2626;
        --shadow: rgba(0,0,0,0.1);
      }
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s ease, color 0.3s ease;
    }

    header {
      padding: 16px;
      font-size: 22px;
      font-weight: 600;
    }

    .container {
      padding: 16px;
      display: grid;
      gap: 16px;
    }

    .card {
      background: var(--card);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 10px 30px var(--shadow);
      transition: background 0.3s ease;
    }

    .habit {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 10px;
    }

    .habit-left {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    input[type="checkbox"] {
      width: 22px;
      height: 22px;
      accent-color: var(--success);
    }

    .delete, .edit {
      background: none;
      border: none;
      font-size: 16px;
      margin-left: 4px;
    }

    .delete { color: var(--danger); }
    .edit { color: var(--accent); }

    .progress {
      height: 10px;
      background: rgba(148,163,184,0.25);
      border-radius: 999px;
      overflow: hidden;
      margin-top: 12px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--success));
      width: 0%;
      transition: width 0.4s ease;
    }

    .row {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    input[type="text"] {
      flex: 1;
      padding: 10px;
      border-radius: 12px;
      border: none;
      outline: none;
      background: rgba(148,163,184,0.15);
      color: var(--text);
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 12px;
      font-weight: 600;
    }

    .muted { color: var(--muted); }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-top: 10px;
    }

    .day {
      aspect-ratio: 1;
      border-radius: 8px;
      background: rgba(148,163,184,0.25);
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .day.good { background: var(--success); color: white; }
    .day.today { outline: 2px solid var(--accent); }

    canvas { width: 100%; max-height: 180px; }

    .confetti {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .confetti span {
      position: absolute;
      width: 8px;
      height: 8px;
      background: hsl(var(--h), 90%, 60%);
      filter: drop-shadow(0 0 6px rgba(255,255,255,0.4));
      animation: fall 1.1s cubic-bezier(.2,.8,.2,1) forwards;
    }

    @keyframes fall {
      from { transform: translateY(-20px) rotate(0deg); }
      to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <header>Habit Tracker</header>

  <div class="container">
    <div class="card">
      <h3 id="streak"></h3>
      <div id="habits"></div>

      <div class="row">
        <input type="text" id="newHabit" placeholder="Add a new habit" />
        <button onclick="addHabit()">Add</button>
      </div>

      <div class="progress">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <p class="muted" id="stats"></p>
      <button onclick="finishDay()">Finish Day</button>
    </div>

    <div class="card">
      <h3>This Month</h3>
      <div class="calendar" id="calendar"></div>
    </div>

    <div class="card">
      <h3>Completion Chart</h3>
      <canvas id="chart"></canvas>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>

  <script>
    let habits = JSON.parse(localStorage.getItem('habits')) || [];
    let history = JSON.parse(localStorage.getItem('history')) || {};

    function todayKey() {
      return new Date().toISOString().slice(0,10);
    }

    function renderHabits() {
      const el = document.getElementById('habits');
      el.innerHTML = '';

      habits.forEach((h, i) => {
        const row = document.createElement('div');
        row.className = 'habit';
        row.innerHTML = `
          <div class="habit-left">
            <input type="checkbox" ${h.done ? 'checked' : ''} onchange="toggleHabit(${i})" />
            <span>${h.name}</span>
          </div>
          <div>
            <button class="edit" onclick="editHabit(${i})">âœŽ</button>
            <button class="delete" onclick="deleteHabit(${i})">âœ•</button>
          </div>
        `;
        el.appendChild(row);
      });

      updateProgress();
      updateStreak();
    }

    function addHabit() {
      const input = document.getElementById('newHabit');
      if (!input.value.trim()) return;
      habits.push({ name: input.value.trim(), done: false });
      input.value = '';
      save();
      renderHabits();
    }

    function editHabit(i) {
      const name = prompt('Edit habit name', habits[i].name);
      if (name) habits[i].name = name;
      save();
      renderHabits();
    }

    function deleteHabit(i) {
      habits.splice(i, 1);
      save();
      renderHabits();
    }

    function toggleHabit(i) {
      habits[i].done = !habits[i].done;
      save();
      updateProgress();
      popConfetti();
      if (navigator.vibrate) navigator.vibrate(20);
    }

    function updateProgress() {
      if (!habits.length) return;
      const completed = habits.filter(h => h.done).length;
      const percent = Math.round((completed / habits.length) * 100);
      document.getElementById('progressFill').style.width = percent + '%';
      document.getElementById('stats').textContent = `${completed}/${habits.length} habits completed`;
    }

    function finishDay() {
      if (!habits.length) return;
      const today = todayKey();
      const ratio = habits.filter(h => h.done).length / habits.length;
      history[today] = ratio;
      habits.forEach(h => h.done = false);
      save();
      renderHabits();
      renderCalendar();
      renderChart();
      if (navigator.vibrate) navigator.vibrate([30,40,30]);
    }

    function updateStreak() {
      let streak = 0;
      let d = new Date();
      while (true) {
        const key = d.toISOString().slice(0,10);
        if (history[key] >= 0.75) streak++;
        else break;
        d.setDate(d.getDate() - 1);
      }
      document.getElementById('streak').textContent = `ðŸ”¥ ${streak}-day streak`;
    }

    function renderCalendar() {
      const cal = document.getElementById('calendar');
      cal.innerHTML = '';
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const first = new Date(year, month, 1).getDay();
      const days = new Date(year, month + 1, 0).getDate();

      for (let i = 0; i < first; i++) cal.appendChild(document.createElement('div'));

      for (let d = 1; d <= days; d++) {
        const key = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const div = document.createElement('div');
        div.className = 'day';
        div.textContent = d;
        if (history[key] >= 0.75) div.classList.add('good');
        if (key === todayKey()) div.classList.add('today');
        cal.appendChild(div);
      }
    }

    function renderChart() {
      const ctx = document.getElementById('chart').getContext('2d');
      ctx.clearRect(0,0,300,180);
      const vals = Object.values(history).slice(-14);
      vals.forEach((v, i) => {
        ctx.fillStyle = '#38bdf8';
        ctx.fillRect(i * 20, 180 - v * 180, 12, v * 180);
      });
    }

    function popConfetti() {
      const c = document.getElementById('confetti');
      for (let i = 0; i < 20; i++) {
        const s = document.createElement('span');
        s.style.left = Math.random() * 100 + '%';
        s.style.setProperty('--h', Math.random() * 360);
        c.appendChild(s);
        setTimeout(() => s.remove(), 1100);
      }
    }

    function save() {
      localStorage.setItem('habits', JSON.stringify(habits));
      localStorage.setItem('history', JSON.stringify(history));
    }

    renderHabits();
    renderCalendar();
    renderChart();
  </script>
</body>
</html>
